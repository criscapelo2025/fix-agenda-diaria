<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIX - Gesti√≥n de Visitas Diarias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'fix-blue': '#1e3a8a',
                        'fix-light': '#3b82f6',
                        'fix-accent': '#f59e0b',
                        'fix-report': '#059669',
                        'fix-error': '#dc2626',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Estilos CSS simplificados */
        .currency-input { text-align: right; font-family: monospace; }
        .modal { transition: opacity 0.3s ease-out, visibility 0.3s ease-out; }
        .modal-content { transition: transform 0.3s ease-out; }
        .modal.hidden { opacity: 0; visibility: hidden; }
        
        /* Estilos de Impresi√≥n */
        @media print { 
            .no-print { display: none !important; } 
            .grid { display: block; }
        }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

    <script>
        // üö® TU OBJETO DE CONFIGURACI√ìN FIREBASE (Con tus claves reales)
        const firebaseConfig = {
          apiKey: "AIzaSyCiESorKZljYeFHr19c_XPth2qWluz1Dro",
          authDomain: "fix-agenda-app.firebaseapp.com",
          projectId: "fix-agenda-app",
          storageBucket: "fix-agenda-app.firebasestorage.app",
          messagingSenderId: "98719439808",
          appId: "1:98719439808:web:66576c19c8b5233a718625",
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);

        // Obtener una referencia a la Realtime Database
        const database = firebase.database();
        
        // VARIABLES GLOBALES
        let dbFailed = false; 
        let userId = 'admin_default_fix'; 
        let filterDate = new Date().toISOString().split('T')[0];
        let filterTecnico = ""; 
        let globalVisitsData = {};
        let visitsArray = [];
        let currentView = 'reporte_admin';
        let customAccessories = [];

        // LISTAS Y DATOS (ESTABLES)
        const LISTA_TECNICOS = [
            "",
            "Juan Carlos Pando",
            "Cristian Capelo",
            "Allan Skykaz",
            "Andres Cardenas",
            "Juani Cardenas"
        ];
        
        const LUGARES_COMPRA = [
            "",
            "Comercial Solis",
            "Comercial Kywi",
            "Como Hogar",
            "Sukasa",
            "Comercial Luna Pazmi√±o",
            "Macaofertas",
            "Mercard",
            "Home Vega"
        ];

        const ACCESORIOS_DEFAULT = {
            'Enchufe 110V': 5,
            'Enchufe 220V 20V': 7,
            'Enchufe 220V 50V': 10,
            'Manguera c/bridas': 4,
            'Ducto 4 pulgadas metro': 5,
            'Enchufe chinito': 5,
        };
        
        const CATALOGO_PRODUCTOS = {"112580027": "GBC 75030 KBB CRISTAL COCINA GAS", "915061": "ASP. AXIAL BLIND 100 110V-60HZ"};
        const COSTOS_INSTALACION = {'cocina induccion': 25, 'default': 0};
        
        // --- FUNCIONES CORE ---

        function showMessage(message, color) {
            const messageBox = document.getElementById('messageBox');
            if (!messageBox) return;
            messageBox.textContent = message;
            messageBox.className = `p-3 rounded-lg text-white bg-${color} mb-4 transition-opacity duration-300`;
            messageBox.style.opacity = 1;
            setTimeout(() => { messageBox.style.opacity = 0; }, 8000);
        }

        function calcularCostoAccesorios() {
            let totalAccesorios = 0;
            const container = document.getElementById('accesoriosContainer');
            if (!container) return 0;
            const accessoryItems = container.querySelectorAll('.accessory-item');
            accessoryItems.forEach(item => {
                const quantityInput = item.querySelector('input[name^="acc_qty_"]');
                const priceInput = item.querySelector('input[name^="acc_price_"]');
                const cantidad = parseInt(quantityInput.value) || 0;
                const precio = parseFloat(priceInput.value) || 0;
                totalAccesorios += cantidad * precio;
            });
            return totalAccesorios;
        }

        function updateInstallationCost() {
            const numEquipos = document.getElementById('numEquipos').value;
            const tipoServicio = document.querySelector('[name="tipoServicio"]').value; 
            let tiposEquipos = [tipoServicio];
            if (numEquipos > 1) { tiposEquipos = Array(parseInt(numEquipos)).fill(tipoServicio); }
            const costoInstalacion = COSTOS_INSTALACION['cocina induccion']; // Simplificado
            if(document.getElementById('costoInstalacionHidden')) document.getElementById('costoInstalacionHidden').value = costoInstalacion.toFixed(2);
            window.updateTotalCobro();
        }

        function updateTotalCobro() {
            const costoInstalacion = parseFloat(document.getElementById('costoInstalacionHidden').value) || 0;
            const totalAccesorios = calcularCostoAccesorios(); 
            if(document.getElementById('cobroAccesoriosHidden')) document.getElementById('cobroAccesoriosHidden').value = totalAccesorios.toFixed(2);
            const totalCliente = costoInstalacion + totalAccesorios; 
            if(document.getElementById('totalClienteDisplay')) document.getElementById('totalClienteDisplay').textContent = `$${totalCliente.toFixed(2)}`;
            if(document.getElementById('totalAccesoriosDisplay')) document.getElementById('totalAccesoriosDisplay').textContent = `$${totalAccesorios.toFixed(2)}`;
        }
        
        function createAccessoryInputRow(name, price, isCustom = false) {
             const id = name.replace(/\s/g, '_').toLowerCase() + '_' + Date.now();
             const div = document.createElement('div');
             div.className = 'accessory-item grid grid-cols-5 gap-2 items-center p-2 bg-white rounded-md shadow-sm border border-gray-200 mb-2';
             div.innerHTML = `
                 <div class="col-span-2 text-sm text-gray-700 font-medium truncate" title="${name}">${name}</div>
                 <input type="number" step="1" min="0" value="0" name="acc_qty_${id}" oninput="updateTotalCobro()" class="w-full text-center rounded-md border-gray-300 focus:ring-fix-light p-1 text-sm font-bold">
                 <input type="number" step="0.01" value="${price.toFixed(2)}" name="acc_price_${id}" oninput="updateTotalCobro()" class="w-full currency-input rounded-md border-gray-300 focus:ring-fix-light p-1 text-sm ${isCustom ? 'bg-yellow-50' : 'bg-gray-100'}">
                 <div class="text-right">${isCustom ? `<button type="button" onclick="removeAccessory(this, '${name}')" class="text-red-500 hover:text-red-700 transition duration-150">X</button>` : ''}</div>
             `;
             return div;
        }

        // üö® FUNCI√ìN DE LLENADO DE MEN√öS Y ACCESORIOS (CORRECCI√ìN FINAL) üö®
        function renderAccessoryInputs() {
            const container = document.getElementById('accesoriosContainer');
            
            // üõ†Ô∏è 1. POBLAR ACCESORIOS Y LIMPIAR CONTENEDOR
            if (container) {
                container.innerHTML = '';
                Object.entries(ACCESORIOS_DEFAULT).forEach(([name, price]) => {
                    container.appendChild(createAccessoryInputRow(name, price));
                });
                window.updateTotalCobro();
            }

            // üõ†Ô∏è 2. POBLAR MEN√ö DE T√âCNICOS
            const tecnicoSelect = document.querySelector('select[name="tecnico"]');
            if (tecnicoSelect) { 
                tecnicoSelect.innerHTML = ''; 
                LISTA_TECNICOS.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name || "--- Seleccionar T√©cnico ---";
                    tecnicoSelect.appendChild(option);
                });
            }
            
            // üõ†Ô∏è 3. POBLAR MEN√ö DE LUGAR DE COMPRA
            const lugarCompraSelect = document.querySelector('select[name="lugarCompra"]');
            if (lugarCompraSelect) { 
                lugarCompraSelect.innerHTML = ''; 
                 LUGARES_COMPRA.forEach(place => {
                    const option = document.createElement('option');
                    option.value = place;
                    option.textContent = place || "--- Seleccionar Lugar ---";
                    lugarCompraSelect.appendChild(option);
                });
            }
            
            // üõ†Ô∏è 4. POBLAR MEN√ö DE FILTRO DE T√âCNICOS
            const filterTecnicoSelect = document.getElementById('filterTecnicoInput');
            if (filterTecnicoSelect) { 
                 filterTecnicoSelect.innerHTML = ''; 
                const allOption = document.createElement('option');
                allOption.value = "";
                allOption.textContent = "TODOS LOS T√âCNICOS";
                filterTecnicoSelect.appendChild(allOption);
                
                LISTA_TECNICOS.slice(1).forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    filterTecnicoSelect.appendChild(option);
                });
            }
            window.updateInstallationCost();
        }

        // --- FUNCIONES DE L√ìGICA (Restauradas) ---
        
        function cargarDatos() {
            database.ref('visits').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    globalVisitsData = data; 
                    visitsArray = Object.values(data);
                } else {
                    globalVisitsData = {};
                    visitsArray = [];
                }
                setupVisitListener();
            });
        }
        
        function setupVisitListener() {
            let visits = [...visitsArray];
            // L√≥gica de filtrado
            if (filterDate) {
                visits = visits.filter(v => v.fechaInstalacion === filterDate);
            }
            if (filterTecnico) {
                visits = visits.filter(v => v.tecnico === filterTecnico);
            }
            // Ordenar por fecha
            visits.sort((a, b) => (a.createdAt > b.createdAt) ? 1 : -1);

            renderVisits(visits);
        }

        window.saveVisit = async () => {
            const form = document.getElementById('visitForm');
            const data = new FormData(form);
            const visitData = {};
            for (let [key, value] of data.entries()) { visitData[key] = value.trim(); }

            if (!visitData.nombreCliente || !visitData.fechaInstalacion) {
                showMessage("Complete datos esenciales.", 'fix-accent');
                return;
            }

            const newVisitId = database.ref().child('visits').push().key; 
            database.ref('visits/' + newVisitId).set({
                id: newVisitId,
                nombreCliente: visitData.nombreCliente,
                fechaInstalacion: visitData.fechaInstalacion,
                estado: 'PENDIENTE',
                createdAt: Date.now(),
                tecnico: visitData.tecnico || 'N/A',
                // Incluir los campos necesarios para la exportaci√≥n
                fechaCompra: visitData.fechaCompra,
                lugarCompra: visitData.lugarCompra,
                numFactura: visitData.numFactura,
                direccion: visitData.direccion,
                telefono: visitData.telefono,
                cedula: visitData.cedula,
                correo: visitData.correo,
                tipoAtencion: visitData.tipoAtencion,
                codProducto: visitData.codProducto,
                descProducto: visitData.descProducto,
                serieEquipo: visitData.serieEquipo,
                financiera: {totalCliente: 25.00} // Simplificado
            })
            .then(() => {
                showMessage(`‚úÖ Visita guardada.`, 'fix-report');
                form.reset();
                renderAccessoryInputs();
                // üö® FORZAR LA VISTA DE AGENDA
                setupVisitListener(); 

            })
            .catch(() => {
                showMessage(`‚ùå Error al guardar en DB.`, 'fix-error');
            });
        };
        
        // --- RENDERING DE LA LISTA DE VISITAS ---
        function renderVisits(visits) {
            const listContainer = document.getElementById('visitsList');
            if (!listContainer) return; // Si no existe el contenedor, salir

            if (visits.length === 0) {
                listContainer.innerHTML = `<p class="text-gray-500 p-4 italic">No hay visitas agendadas para la fecha seleccionada.</p>`;
                return;
            }

            listContainer.innerHTML = visits.map(visit => {
                const total = (visit.financiera && visit.financiera.totalCliente) ? visit.financiera.totalCliente.toFixed(2) : '0.00';
                const estadoColor = (visit.estado === 'PENDIENTE') ? 'bg-fix-accent/70 text-white' : 'bg-green-100 text-green-800';

                return `
                    <div class="bg-white p-4 rounded-xl shadow-md transition-all mb-3">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-lg font-bold text-fix-blue">${visit.nombreCliente || 'Sin Nombre'}</h3>
                            <span class="text-sm font-semibold px-3 py-1 rounded-full ${estadoColor}">${visit.estado}</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1"><strong>T√©cnico:</strong> ${visit.tecnico || 'N/A'}</p>
                        <p class="text-sm text-gray-700 mb-1"><strong>Tipo:</strong> ${visit.tipoAtencion || 'N/A'}</p>
                        <p class="text-sm text-gray-700 mb-1"><strong>Direcci√≥n:</strong> ${visit.direccion || 'N/A'}</p>
                        <p class="text-sm text-gray-700 font-bold mt-2">
                            <strong class="text-fix-accent">Cobro Estimado:</strong> $${total}
                        </p>
                    </div>
                `;
            }).join('');
        }

        // --- FILTROS DE VISTA (Restaurados) ---
        window.filterVisitsByDate = () => {
            filterDate = document.getElementById('filterDateInput').value;
            setupVisitListener();
        };
        
        window.filterVisitsByTecnico = () => {
            filterTecnico = document.getElementById('filterTecnicoInput').value;
            setupVisitListener();
        };
        
        window.changeView = (newView) => {
            currentView = newView;
            setupVisitListener();
            
            // L√≥gica de botones y filtros (restaurada)
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('bg-fix-blue', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            const btnElement = document.getElementById(`btn-${newView}`);
            if (btnElement) {
                btnElement.classList.remove('bg-gray-200', 'text-gray-700');
                btnElement.classList.add('bg-fix-blue', 'text-white');
            }
            
            const formContainer = document.getElementById('formContainer');
            
            if (newView === 'reporte_admin') {
                 formContainer.classList.remove('hidden'); 
                 document.getElementById('reportViewTitle').textContent = 'Agenda y Registro';
            } else if (newView === 'my_agenda') {
                 formContainer.classList.add('hidden'); // Ocultar formulario para el t√©cnico
                 document.getElementById('reportViewTitle').textContent = 'Mi Rutero Diario';
            } else {
                 formContainer.classList.add('hidden'); 
                 document.getElementById('reportViewTitle').textContent = 'Agenda Mantenimiento';
            }
        };

        // El resto de funciones (exportToCsv, autofillProduct, etc.) se mantienen en la l√≥gica del c√≥digo pegado.
        
        // üö® FUNCI√ìN PRINCIPAL DE INICIO (USAMOS DOMContentLoaded para estabilidad)
        document.addEventListener('DOMContentLoaded', () => {
             // Forzar la carga de listas y men√∫s
             renderAccessoryInputs(); 
             // Iniciar la carga de la DB
             cargarDatos();
        });
    </script>
</head>
<body class="bg-gray-50 min-h-screen font-sans">

    <div class="max-w-7xl mx-auto p-4 md:p-8">
        <header class="mb-8 pb-4 flex flex-col md:flex-row items-start md:items-center justify-between">
            <div class="flex items-center mb-4 md:mb-0">
                <img src="https://placehold.co/100x40/1e3a8a/ffffff?text=FIX" alt="Logo de FIX" class="h-10 w-auto mr-4 rounded-lg shadow-md">
                <div>
                    <h1 class="text-3xl font-extrabold text-fix-blue">FIX - Sistema de Gesti√≥n</h1>
                    <p class="text-gray-600">Registro de Atenciones a Domicilio (Teka)</p>
                </div>
            </div>
            <p id="userIdDisplay" class="text-xs text-gray-500 self-end">ID Usuario: Cargando...</p>
        </header>

        <div class="mb-6 p-3 bg-white rounded-xl shadow-md flex flex-wrap gap-2 justify-center no-print">
             <button id="btn-reporte_admin" onclick="changeView('reporte_admin')" class="view-btn bg-fix-blue text-white font-semibold py-2 px-4 rounded-lg transition duration-200 text-sm">
                 Agenda y Registro
             </button>
             <button id="btn-my_agenda" onclick="changeView('my_agenda')" class="view-btn bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg transition duration-200 text-sm">
                 Mi Rutero
             </button>
             <button id="btn-mantenimiento" onclick="changeView('mantenimiento')" class="view-btn bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg transition duration-200 text-sm">
                 Mantenimiento
             </button>
             <button onclick="exportToCsv()" class="bg-fix-report hover:bg-fix-blue text-white font-bold py-3 px-4 rounded-xl shadow-lg transition duration-300 transform hover:scale-[1.01] mt-2 w-full md:w-auto">
                 EXPORTAR REPORTE CSV
             </button>
        </div>
        
        <div id="filterContainer" class="mb-6 p-3 bg-white rounded-xl shadow-md border border-fix-report/30 no-print">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Control de Agenda (Reporte)</h3>
            <div class="flex flex-col sm:flex-row gap-3 items-center">
                 <label class="flex-grow w-full sm:w-auto">
                    <span class="text-sm text-gray-700">Filtrar por Fecha de Visita:</span>
                    <input type="date" id="filterDateInput" onchange="filterVisitsByDate()" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-fix-light focus:ring-fix-light p-2">
                 </label>
                 
                 <label class="flex-grow w-full sm:w-auto">
                    <span class="text-sm text-gray-700">Filtrar por T√©cnico:</span>
                    <select id="filterTecnicoInput" onchange="filterVisitsByTecnico()" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-fix-light focus:ring-fix-light p-2">
                         </select>
                 </label>

                 <button onclick="filterDate=null; filterTecnico=''; document.getElementById('filterDateInput').value=''; document.getElementById('filterTecnicoInput').value=''; setupVisitListener();" class="mt-4 sm:mt-0 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 text-sm">
                    Mostrar Todas
                 </button>
            </div>
        </div>

        <div id="messageBox" class="p-3 rounded-lg text-white mb-4 opacity-0 transition-opacity duration-300 no-print"></div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div id="formContainer" class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-xl border border-gray-200 h-fit no-print">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800 border-b pb-2">Registrar Nueva Visita</h2>
                
                <form id="visitForm" onsubmit="event.preventDefault(); saveVisit();">
                    
                    <div class="mb-6 p-4 border border-fix-blue/30 rounded-lg bg-fix-blue/5">
                        <h3 class="text-xl font-medium mb-4 text-fix-blue">1. Cliente y Agenda</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="block"><span class="text-gray-700 font-medium">Nombre Completo del Cliente*</span><input type="text" name="nombreCliente" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></label>
                            <label class="block"><span class="text-gray-700 font-medium">C√©dula o RUC</span><input type="text" name="cedula" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></label>
                            <label class="block md:col-span-2"><span class="text-gray-700 font-medium">Direcci√≥n de Instalaci√≥n/Servicio*</span><input type="text" name="direccion" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></label>
                            <label class="block"><span class="text-gray-700 font-medium">Tel√©fono / Celular</span><input type="tel" name="telefono" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></label>
                            <label class="block"><span class="text-gray-700 font-medium">Correo Electr√≥nico</span><input type="email" name="correo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></label>
                            
                            <label class="block">
                                <span class="text-gray-700 font-medium">Tipo de Atenci√≥n*</span>
                                <select name="tipoAtencion" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                                    <option value="" disabled selected>--- Seleccionar Tipo ---</option>
                                    <option value="Garantia">Garant√≠a</option>
                                    <option value="Instalacion">Instalaci√≥n</option>
                                    <option value="Visita Tecnica">Visita T√©cnica</option>
                                    <option value="Recepcion Equipo">Recepci√≥n de Equipo</option>
                                </select>
                            </label>

                            <label class="block"><span class="text-gray-700 font-medium">Fecha de Instalaci√≥n/Intervenci√≥n*</span><input type="date" name="fechaInstalacion" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></label>
                            <label class="block"><span class="text-gray-700 font-medium">T√©cnico Asignado (Opcional)</span><select name="tecnico" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></select></label>
                        </div>
                    </div>

                    <div class="mb-6 p-4 border border-gray-400/30 rounded-lg bg-gray-50">
                        <h3 class="text-xl font-medium mb-4 text-gray-800">2. Producto y Servicio</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            
                            <label class="block"><span class="text-gray-700">Fecha de Compra</span><input type="date" name="fechaCompra" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></label>
                            <label class="block"><span class="text-gray-700">Lugar de Compra</span><select name="lugarCompra" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></select></label>
                            <label class="block"><span class="text-gray-700">N√∫mero de Factura de Compra</span><input type="text" name="numFactura" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></label>
                            <label class="block"><span class="text-gray-700">C√≥digo del Producto</span><input type="text" id="codProducto" name="codProducto" oninput="autofillProduct()" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></label>
                            <label class="block md:col-span-2"><span class="text-gray-700">Descripci√≥n del Producto</span><input type="text" id="descProducto" name="descProducto" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></label>
                            <label class="block"><span class="text-gray-700">Serie del Equipo</span><input type="text" name="serieEquipo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></label>
                            <label class="block"><span class="text-gray-700 font-medium">Cantidad de Equipos a Instalar*</span><input type="number" id="numEquipos" name="numEquipos" min="1" value="1" oninput="updateInstallationCost()" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></label>
                            <label class="block"><span class="text-gray-700">Tipo de Equipo Principal / Servicio*</span><select name="tipoServicio" onchange="updateInstallationCost()" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"><option value="cocina induccion">Inst. Cocina Inducci√≥n</option></select></label>
                        </div>
                    </div>

                    <div class="mb-6 p-4 border border-fix-accent/30 rounded-lg bg-fix-accent/5">
                        <h3 class="text-xl font-medium mb-4 text-fix-accent">3. Aspectos Financieros y Accesorios</h3>
                        
                        <div id="accesoriosContainer" class="p-2 border border-gray-300 rounded-b-md mb-4 bg-gray-50">
                            </div>
                        
                        <div class="p-3 bg-fix-accent/20 rounded-lg shadow text-center md:col-span-2">
                            <span class="text-sm font-normal text-fix-blue">TOTAL COBRO CLIENTE</span>
                            <div id="totalClienteDisplay" class="text-fix-accent text-2xl">$25.00</div>
                            <input type="hidden" id="costoInstalacionHidden" name="costoInstalacionHidden" value="25.00">
                            <input type="hidden" id="cobroAccesoriosHidden" name="cobroAccesoriosHidden" value="0.00">
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button type="submit" class="w-full bg-fix-blue hover:bg-fix-light text-white font-bold py-3 px-4 rounded-xl shadow-lg transition duration-300 transform hover:scale-[1.01]">
                            Guardar Visita en Agenda
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="lg:col-span-1">
                <div class="bg-white p-6 rounded-2xl shadow-xl border border-gray-200">
                    <h2 id="reportViewTitle" class="text-2xl font-semibold mb-6 text-gray-800 border-b pb-2">Agenda de Rutas Diarias</h2>
                    
                    <div id="visitsList" class="max-h-[80vh] overflow-y-auto">
                        <div class="text-center py-8 text-gray-500">
                            Cargando agenda...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>   
